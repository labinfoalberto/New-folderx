<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento Escolar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading { 
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #10b981; }
        .notification.error { background-color: #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üìö Sistema de Gerenciamento Escolar</h1>
                    <p class="text-gray-600">Gerencie alunos, turmas e acompanhe o desempenho acad√™mico</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="connectionStatus" class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        <span class="text-sm text-gray-600">Conectando...</span>
                    </div>
                    <button onclick="syncData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                        <span>üîÑ</span>
                        <span>Sincronizar</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-8">
            <div class="flex flex-wrap gap-2">
                <button onclick="showSection('dashboard')" class="nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    üìä Dashboard
                </button>
                <button onclick="showSection('students')" class="nav-btn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    üë• Alunos
                </button>
                <button onclick="showSection('classes')" class="nav-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                    üè´ Turmas
                </button>
                <button onclick="showSection('grades')" class="nav-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                    üìù Notas
                </button>
                <button onclick="showSection('attendance')" class="nav-btn bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                    ‚úÖ Presen√ßa
                </button>
                <button onclick="showSection('reports')" class="nav-btn bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                    üìà Relat√≥rios
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total de Alunos</p>
                            <p class="text-2xl font-bold text-blue-600" id="totalStudents">
                                <div class="loading"></div>
                            </p>
                        </div>
                        <div class="text-3xl">üë•</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total de Turmas</p>
                            <p class="text-2xl font-bold text-green-600" id="totalClasses">
                                <div class="loading"></div>
                            </p>
                        </div>
                        <div class="text-3xl">üè´</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">M√©dia Geral</p>
                            <p class="text-2xl font-bold text-purple-600" id="averageGrade">
                                <div class="loading"></div>
                            </p>
                        </div>
                        <div class="text-3xl">üìä</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Presen√ßa M√©dia</p>
                            <p class="text-2xl font-bold text-orange-600" id="averageAttendance">
                                <div class="loading"></div>
                            </p>
                        </div>
                        <div class="text-3xl">‚úÖ</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Atividade Recente</h3>
                <div id="recentActivity" class="space-y-3">
                    <div class="loading"></div>
                </div>
            </div>
        </div>

        <!-- Students Section -->
        <div id="students" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Gerenciar Alunos</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <input type="text" id="studentName" placeholder="Nome do aluno" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="email" id="studentEmail" placeholder="Email do aluno" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="tel" id="studentPhone" placeholder="Telefone" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <select id="studentClass" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Selecionar turma</option>
                    </select>
                </div>
                <button onclick="addStudent()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    ‚ûï Adicionar Aluno
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Lista de Alunos</h3>
                    <input type="text" id="studentSearch" placeholder="Buscar aluno..." class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Nome</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Email</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Telefone</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Turma</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <tr><td colspan="5" class="text-center py-8"><div class="loading mx-auto"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="classes" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Gerenciar Turmas</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="className" placeholder="Nome da turma" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="text" id="classTeacher" placeholder="Professor respons√°vel" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="number" id="classCapacity" placeholder="Capacidade m√°xima" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <button onclick="addClass()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                    ‚ûï Adicionar Turma
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Lista de Turmas</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="classesGrid">
                    <div class="text-center py-8"><div class="loading mx-auto"></div></div>
                </div>
            </div>
        </div>

        <!-- Grades Section -->
        <div id="grades" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Gerenciar Notas</h2>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
                    <select id="gradeStudent" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="">Selecionar aluno</option>
                    </select>
                    <input type="text" id="gradeSubject" placeholder="Mat√©ria" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                    <input type="number" id="gradeValue" placeholder="Nota (0-10)" min="0" max="10" step="0.1" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                    <select id="gradeType" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="prova">Prova</option>
                        <option value="trabalho">Trabalho</option>
                        <option value="participacao">Participa√ß√£o</option>
                        <option value="projeto">Projeto</option>
                    </select>
                    <input type="date" id="gradeDate" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                </div>
                <button onclick="addGrade()" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                    ‚ûï Adicionar Nota
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Registro de Notas</h3>
                    <select id="gradeFilter" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="">Todos os alunos</option>
                    </select>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Aluno</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Mat√©ria</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Tipo</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Nota</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Data</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="gradesTable">
                            <tr><td colspan="6" class="text-center py-8"><div class="loading mx-auto"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Attendance Section -->
        <div id="attendance" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Controle de Presen√ßa</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <select id="attendanceClass" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-transparent">
                        <option value="">Selecionar turma</option>
                    </select>
                    <input type="date" id="attendanceDate" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-transparent">
                    <button onclick="loadAttendance()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        üìã Carregar Lista
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Lista de Presen√ßa</h3>
                <div id="attendanceList">
                    <p class="text-gray-500 text-center py-8">Selecione uma turma e data para carregar a lista de presen√ßa</p>
                </div>
                <button onclick="saveAttendance()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors mt-4 hidden" id="saveAttendanceBtn">
                    üíæ Salvar Presen√ßa
                </button>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Relat√≥rio de Notas por Turma</h3>
                    <select id="reportClassSelect" class="border border-gray-300 rounded-lg px-4 py-2 mb-4 w-full focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="">Selecionar turma</option>
                    </select>
                    <div id="gradeReport" class="space-y-3">
                        <p class="text-gray-500">Selecione uma turma para ver o relat√≥rio</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Relat√≥rio de Frequ√™ncia</h3>
                    <select id="attendanceReportClass" class="border border-gray-300 rounded-lg px-4 py-2 mb-4 w-full focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="">Selecionar turma</option>
                    </select>
                    <div id="attendanceReport" class="space-y-3">
                        <p class="text-gray-500">Selecione uma turma para ver o relat√≥rio</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let classes = JSON.parse(localStorage.getItem('classes')) || [];
        let grades = JSON.parse(localStorage.getItem('grades')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || [];

        // Initialize with sample data if empty
        if (classes.length === 0) {
            classes = [
                { id: '1', name: '1¬∫ Ano A', teacher: 'Prof. Maria Silva', capacity: 30 },
                { id: '2', name: '2¬∫ Ano B', teacher: 'Prof. Jo√£o Santos', capacity: 25 },
                { id: '3', name: '3¬∫ Ano C', teacher: 'Prof. Ana Costa', capacity: 28 }
            ];
            saveData();
        }

        if (students.length === 0) {
            students = [
                { id: '1', name: 'Pedro Silva', email: 'pedro@email.com', phone: '(11) 99999-9999', classId: '1' },
                { id: '2', name: 'Maria Santos', email: 'maria@email.com', phone: '(11) 88888-8888', classId: '1' },
                { id: '3', name: 'Jo√£o Costa', email: 'joao@email.com', phone: '(11) 77777-7777', classId: '2' }
            ];
            saveData();
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateConnectionStatus() {
            const status = document.getElementById('connectionStatus');
            const dot = status.querySelector('div');
            const text = status.querySelector('span');
            
            dot.className = 'w-3 h-3 bg-green-500 rounded-full';
            text.textContent = 'Sistema Local';
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('classes', JSON.stringify(classes));
            localStorage.setItem('grades', JSON.stringify(grades));
            localStorage.setItem('attendance', JSON.stringify(attendance));
        }

        function syncData() {
            showNotification('Dados salvos localmente!');
            updateDashboard();
            renderCurrentSection();
        }

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            document.getElementById(sectionName).classList.add('fade-in');
            
            renderCurrentSection();
        }

        function renderCurrentSection() {
            const visibleSection = document.querySelector('.section:not(.hidden)');
            if (!visibleSection) return;

            const sectionId = visibleSection.id;
            switch(sectionId) {
                case 'dashboard': updateDashboard(); break;
                case 'students': renderStudents(); break;
                case 'classes': renderClasses(); break;
                case 'grades': renderGrades(); break;
                case 'attendance': renderAttendance(); break;
                case 'reports': renderReports(); break;
            }
        }

        // Dashboard functions
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('totalClasses').textContent = classes.length;
            
            const avgGrade = grades.length > 0 ? 
                (grades.reduce((sum, grade) => sum + parseFloat(grade.value), 0) / grades.length).toFixed(1) : '0.0';
            document.getElementById('averageGrade').textContent = avgGrade;
            
            const attendanceRecords = attendance.filter(record => record.present);
            const totalRecords = attendance.length;
            const avgAttendance = totalRecords > 0 ? 
                Math.round((attendanceRecords.length / totalRecords) * 100) : 0;
            document.getElementById('averageAttendance').textContent = avgAttendance + '%';

            // Recent activity
            const recentActivity = document.getElementById('recentActivity');
            const recentGrades = grades.slice(-5).reverse();
            
            if (recentGrades.length === 0) {
                recentActivity.innerHTML = '<p class="text-gray-500">Nenhuma atividade recente</p>';
                return;
            }

            recentActivity.innerHTML = recentGrades.map(grade => {
                const student = students.find(s => s.id === grade.studentId);
                const studentName = student ? student.name : 'Aluno n√£o encontrado';
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">${studentName}</p>
                            <p class="text-sm text-gray-600">${grade.subject} - ${grade.type}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold ${grade.value >= 7 ? 'text-green-600' : grade.value >= 5 ? 'text-yellow-600' : 'text-red-600'}">${grade.value}</p>
                            <p class="text-sm text-gray-500">${new Date(grade.date).toLocaleDateString('pt-BR')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Student functions
        function addStudent() {
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            const phone = document.getElementById('studentPhone').value;
            const classId = document.getElementById('studentClass').value;

            if (name && email && classId) {
                const newStudent = {
                    id: Date.now().toString(),
                    name: name,
                    email: email,
                    phone: phone || '',
                    classId: classId,
                    createdAt: new Date().toISOString()
                };
                
                students.push(newStudent);
                saveData();
                renderStudents();
                clearStudentForm();
                showNotification('Aluno adicionado com sucesso!');
            } else {
                showNotification('Por favor, preencha todos os campos obrigat√≥rios!', 'error');
            }
        }

        function clearStudentForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentClass').value = '';
        }

        function deleteStudent(id) {
            if (confirm('Tem certeza que deseja excluir este aluno?')) {
                students = students.filter(student => student.id !== id);
                grades = grades.filter(grade => grade.studentId !== id);
                attendance = attendance.filter(record => record.studentId !== id);
                saveData();
                renderStudents();
                showNotification('Aluno exclu√≠do com sucesso!');
            }
        }

        function renderStudents() {
            const tbody = document.getElementById('studentsTable');
            const classSelect = document.getElementById('studentClass');
            const gradeStudentSelect = document.getElementById('gradeStudent');
            const gradeFilterSelect = document.getElementById('gradeFilter');
            
            // Update selects
            classSelect.innerHTML = '<option value="">Selecionar turma</option>';
            gradeStudentSelect.innerHTML = '<option value="">Selecionar aluno</option>';
            gradeFilterSelect.innerHTML = '<option value="">Todos os alunos</option>';
            
            classes.forEach(cls => {
                classSelect.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
            });

            students.forEach(student => {
                gradeStudentSelect.innerHTML += `<option value="${student.id}">${student.name}</option>`;
                gradeFilterSelect.innerHTML += `<option value="${student.id}">${student.name}</option>`;
            });

            // Filter students based on search
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm) ||
                student.email.toLowerCase().includes(searchTerm)
            );

            tbody.innerHTML = '';
            filteredStudents.forEach(student => {
                const className = classes.find(cls => cls.id === student.classId)?.name || 'Sem turma';
                tbody.innerHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-4 font-medium">${student.name}</td>
                        <td class="py-3 px-4">${student.email}</td>
                        <td class="py-3 px-4">${student.phone || '-'}</td>
                        <td class="py-3 px-4">${className}</td>
                        <td class="py-3 px-4">
                            <button onclick="deleteStudent('${student.id}')" class="text-red-600 hover:text-red-800 transition-colors">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `;
            });

            // Add search functionality
            document.getElementById('studentSearch').oninput = renderStudents;
        }

        // Class functions
        function addClass() {
            const name = document.getElementById('className').value;
            const teacher = document.getElementById('classTeacher').value;
            const capacity = parseInt(document.getElementById('classCapacity').value) || 30;

            if (name && teacher) {
                const newClass = {
                    id: Date.now().toString(),
                    name: name,
                    teacher: teacher,
                    capacity: capacity,
                    createdAt: new Date().toISOString()
                };
                
                classes.push(newClass);
                saveData();
                renderClasses();
                clearClassForm();
                showNotification('Turma adicionada com sucesso!');
            } else {
                showNotification('Por favor, preencha todos os campos!', 'error');
            }
        }

        function clearClassForm() {
            document.getElementById('className').value = '';
            document.getElementById('classTeacher').value = '';
            document.getElementById('classCapacity').value = '';
        }

        function deleteClass(id) {
            if (confirm('Tem certeza que deseja excluir esta turma?')) {
                classes = classes.filter(cls => cls.id !== id);
                saveData();
                renderClasses();
                showNotification('Turma exclu√≠da com sucesso!');
            }
        }

        function renderClasses() {
            const grid = document.getElementById('classesGrid');
            const attendanceClassSelect = document.getElementById('attendanceClass');
            const reportClassSelect = document.getElementById('reportClassSelect');
            const attendanceReportClass = document.getElementById('attendanceReportClass');
            
            // Update selects
            attendanceClassSelect.innerHTML = '<option value="">Selecionar turma</option>';
            reportClassSelect.innerHTML = '<option value="">Selecionar turma</option>';
            attendanceReportClass.innerHTML = '<option value="">Selecionar turma</option>';
            
            classes.forEach(cls => {
                attendanceClassSelect.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
                reportClassSelect.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
                attendanceReportClass.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
            });

            grid.innerHTML = '';
            classes.forEach(cls => {
                const studentCount = students.filter(student => student.classId === cls.id).length;
                const capacityPercentage = Math.round((studentCount / cls.capacity) * 100);
                const capacityColor = capacityPercentage > 90 ? 'text-red-600' : capacityPercentage > 70 ? 'text-yellow-600' : 'text-green-600';
                
                grid.innerHTML += `
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 border border-purple-200">
                        <h4 class="text-lg font-semibold text-purple-800 mb-2">${cls.name}</h4>
                        <p class="text-purple-600 mb-2">üë®‚Äçüè´ ${cls.teacher}</p>
                        <p class="text-purple-600 mb-2">üë• ${studentCount}/${cls.capacity} alunos</p>
                        <div class="w-full bg-purple-200 rounded-full h-2 mb-4">
                            <div class="bg-purple-600 h-2 rounded-full" style="width: ${capacityPercentage}%"></div>
                        </div>
                        <p class="text-sm ${capacityColor} mb-4">${capacityPercentage}% da capacidade</p>
                        <button onclick="deleteClass('${cls.id}')" class="text-red-600 hover:text-red-800 text-sm transition-colors">
                            üóëÔ∏è Excluir turma
                        </button>
                    </div>
                `;
            });
        }

        // Grade functions
        function addGrade() {
            const studentId = document.getElementById('gradeStudent').value;
            const subject = document.getElementById('gradeSubject').value;
            const value = parseFloat(document.getElementById('gradeValue').value);
            const type = document.getElementById('gradeType').value;
            const date = document.getElementById('gradeDate').value;

            if (studentId && subject && !isNaN(value) && date && value >= 0 && value <= 10) {
                const newGrade = {
                    id: Date.now().toString(),
                    studentId: studentId,
                    subject: subject,
                    value: value,
                    type: type,
                    date: date,
                    createdAt: new Date().toISOString()
                };
                
                grades.push(newGrade);
                saveData();
                renderGrades();
                clearGradeForm();
                showNotification('Nota adicionada com sucesso!');
            } else {
                showNotification('Por favor, preencha todos os campos corretamente! A nota deve estar entre 0 e 10.', 'error');
            }
        }

        function clearGradeForm() {
            document.getElementById('gradeStudent').value = '';
            document.getElementById('gradeSubject').value = '';
            document.getElementById('gradeValue').value = '';
            document.getElementById('gradeType').value = 'prova';
            document.getElementById('gradeDate').value = '';
        }

        function deleteGrade(id) {
            if (confirm('Tem certeza que deseja excluir esta nota?')) {
                grades = grades.filter(grade => grade.id !== id);
                saveData();
                renderGrades();
                showNotification('Nota exclu√≠da com sucesso!');
            }
        }

        function renderGrades() {
            const tbody = document.getElementById('gradesTable');
            const filterSelect = document.getElementById('gradeFilter');
            
            // Filter grades
            const selectedStudent = filterSelect.value;
            const filteredGrades = selectedStudent ? 
                grades.filter(grade => grade.studentId === selectedStudent) : grades;

            tbody.innerHTML = '';
            filteredGrades.forEach(grade => {
                const student = students.find(s => s.id === grade.studentId);
                const studentName = student ? student.name : 'Aluno n√£o encontrado';
                const gradeColor = grade.value >= 7 ? 'text-green-600' : grade.value >= 5 ? 'text-yellow-600' : 'text-red-600';
                
                tbody.innerHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-4 font-medium">${studentName}</td>
                        <td class="py-3 px-4">${grade.subject}</td>
                        <td class="py-3 px-4 capitalize">${grade.type}</td>
                        <td class="py-3 px-4 ${gradeColor} font-semibold">${grade.value.toFixed(1)}</td>
                        <td class="py-3 px-4">${new Date(grade.date).toLocaleDateString('pt-BR')}</td>
                        <td class="py-3 px-4">
                            <button onclick="deleteGrade('${grade.id}')" class="text-red-600 hover:text-red-800 transition-colors">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `;
            });

            // Add filter functionality
            filterSelect.onchange = renderGrades;
        }

        // Attendance functions
        async function loadAttendance() {
            const classId = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;

            if (!classId || !date) {
                showNotification('Por favor, selecione uma turma e uma data!', 'error');
                return;
            }

            const classStudents = students.filter(student => student.classId === classId);
            const attendanceList = document.getElementById('attendanceList');
            const saveBtn = document.getElementById('saveAttendanceBtn');

            if (classStudents.length === 0) {
                attendanceList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum aluno encontrado nesta turma</p>';
                saveBtn.classList.add('hidden');
                return;
            }

            let html = '<div class="space-y-3">';
            classStudents.forEach(student => {
                const existingRecord = attendance.find(record => 
                    record.studentId === student.id && record.date === date
                );
                const isPresent = existingRecord ? existingRecord.present : false;

                html += `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <span class="font-medium">${student.name}</span>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" ${isPresent ? 'checked' : ''} 
                                   data-student-id="${student.id}" data-date="${date}"
                                   class="attendance-checkbox w-5 h-5 text-green-600 rounded focus:ring-green-500">
                            <span class="text-sm ${isPresent ? 'text-green-600' : 'text-gray-500'}">
                                ${isPresent ? 'Presente' : 'Ausente'}
                            </span>
                        </label>
                    </div>
                `;
            });
            html += '</div>';

            attendanceList.innerHTML = html;
            saveBtn.classList.remove('hidden');

            // Add event listeners to checkboxes
            document.querySelectorAll('.attendance-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const label = this.parentElement.querySelector('span');
                    if (this.checked) {
                        label.textContent = 'Presente';
                        label.className = 'text-sm text-green-600';
                    } else {
                        label.textContent = 'Ausente';
                        label.className = 'text-sm text-gray-500';
                    }
                });
            });
        }

        function saveAttendance() {
            const checkboxes = document.querySelectorAll('.attendance-checkbox');
            
            checkboxes.forEach(checkbox => {
                const studentId = checkbox.dataset.studentId;
                const date = checkbox.dataset.date;
                const present = checkbox.checked;

                // Remove existing record for this student and date
                attendance = attendance.filter(record => 
                    !(record.studentId === studentId && record.date === date)
                );

                // Add new record
                attendance.push({
                    id: Date.now().toString() + Math.random(),
                    studentId: studentId,
                    date: date,
                    present: present,
                    createdAt: new Date().toISOString()
                });
            });

            saveData();
            showNotification('Presen√ßa salva com sucesso!');
        }

        function renderAttendance() {
            // This function is called when the attendance section is shown
            // The actual rendering happens in loadAttendance()
        }

        // Reports functions
        function renderReports() {
            const reportClassSelect = document.getElementById('reportClassSelect');
            const attendanceReportClass = document.getElementById('attendanceReportClass');

            reportClassSelect.onchange = generateGradeReport;
            attendanceReportClass.onchange = generateAttendanceReport;
        }

        function generateGradeReport() {
            const classId = document.getElementById('reportClassSelect').value;
            const reportDiv = document.getElementById('gradeReport');

            if (!classId) {
                reportDiv.innerHTML = '<p class="text-gray-500">Selecione uma turma para ver o relat√≥rio</p>';
                return;
            }

            const classStudents = students.filter(student => student.classId === classId);
            const className = classes.find(cls => cls.id === classId)?.name || 'Turma';

            if (classStudents.length === 0) {
                reportDiv.innerHTML = '<p class="text-gray-500">Nenhum aluno encontrado nesta turma</p>';
                return;
            }

            let html = `<h4 class="font-semibold text-gray-800 mb-3">${className}</h4>`;
            
            classStudents.forEach(student => {
                const studentGrades = grades.filter(grade => grade.studentId === student.id);
                const average = studentGrades.length > 0 ? 
                    (studentGrades.reduce((sum, grade) => sum + grade.value, 0) / studentGrades.length).toFixed(1) : 'N/A';
                
                const averageColor = average !== 'N/A' ? 
                    (average >= 7 ? 'text-green-600' : average >= 5 ? 'text-yellow-600' : 'text-red-600') : 'text-gray-500';

                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                        <span class="font-medium">${student.name}</span>
                        <div class="text-right">
                            <span class="text-sm text-gray-600">${studentGrades.length} notas</span>
                            <p class="font-bold ${averageColor}">M√©dia: ${average}</p>
                        </div>
                    </div>
                `;
            });

            reportDiv.innerHTML = html;
        }

        function generateAttendanceReport() {
            const classId = document.getElementById('attendanceReportClass').value;
            const reportDiv = document.getElementById('attendanceReport');

            if (!classId) {
                reportDiv.innerHTML = '<p class="text-gray-500">Selecione uma turma para ver o relat√≥rio</p>';
                return;
            }

            const classStudents = students.filter(student => student.classId === classId);
            const className = classes.find(cls => cls.id === classId)?.name || 'Turma';

            if (classStudents.length === 0) {
                reportDiv.innerHTML = '<p class="text-gray-500">Nenhum aluno encontrado nesta turma</p>';
                return;
            }

            let html = `<h4 class="font-semibold text-gray-800 mb-3">${className}</h4>`;
            
            classStudents.forEach(student => {
                const studentAttendance = attendance.filter(record => record.studentId === student.id);
                const presentCount = studentAttendance.filter(record => record.present).length;
                const totalCount = studentAttendance.length;
                const percentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                const percentageColor = percentage >= 75 ? 'text-green-600' : percentage >= 50 ? 'text-yellow-600' : 'text-red-600';

                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                        <span class="font-medium">${student.name}</span>
                        <div class="text-right">
                            <span class="text-sm text-gray-600">${presentCount}/${totalCount} dias</span>
                            <p class="font-bold ${percentageColor}">${percentage}%</p>
                        </div>
                    </div>
                `;
            });

            reportDiv.innerHTML = html;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = today;
            document.getElementById('gradeDate').value = today;
            
            // Update connection status
            updateConnectionStatus();
            
            // Show dashboard by default
            showSection('dashboard');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f120dbe5e3e022',t:'MTc1NTE4MTU5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
